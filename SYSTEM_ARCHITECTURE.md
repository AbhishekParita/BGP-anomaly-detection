# BGP Anomaly Detection System with Model Drift Detection
# Complete System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PRESENTATION LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   Dashboard     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”‚   FastAPI        â”‚                      â”‚
â”‚  â”‚  (Frontend)     â”‚  JSON   â”‚   (Backend)      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ Query
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATABASE LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      PostgreSQL                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ raw_bgp    â”‚  â”‚features â”‚  â”‚ml_resultsâ”‚  â”‚correlations  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   _data    â”‚  â”‚         â”‚  â”‚          â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  (50K)     â”‚  â”‚ (50K)   â”‚  â”‚  (50K)   â”‚  â”‚   (50K)      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ Store/Read
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DETECTION & CORRELATION LAYER                        â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Heuristic   â”‚   â”‚     LSTM     â”‚   â”‚  Isolation   â”‚                â”‚
â”‚  â”‚   Detector   â”‚   â”‚   Detector   â”‚   â”‚    Forest    â”‚                â”‚
â”‚  â”‚              â”‚   â”‚              â”‚   â”‚   Detector   â”‚                â”‚
â”‚  â”‚ Rule-based   â”‚   â”‚  Temporal    â”‚   â”‚  Statistical â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                  â”‚                  â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                            â†“                                             â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚    Ensemble     â”‚ â† Weighted voting                 â”‚
â”‚                   â”‚   Coordinator   â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â†“                                             â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚  Correlation    â”‚ â† Alert correlation               â”‚
â”‚                   â”‚     Engine      â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ Read features
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEATURE PROCESSING LAYER                              â”‚
â”‚                                                                           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚    Feature      â”‚ â† 30-second windows               â”‚
â”‚                   â”‚   Aggregator    â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â”‚                                             â”‚
â”‚   Creates 9 features:      â”‚                                             â”‚
â”‚   â€¢ announcements          â”‚                                             â”‚
â”‚   â€¢ withdrawals            â”‚                                             â”‚
â”‚   â€¢ total_updates          â”‚                                             â”‚
â”‚   â€¢ withdrawal_ratio       â”‚                                             â”‚
â”‚   â€¢ flap_count             â”‚                                             â”‚
â”‚   â€¢ path_length            â”‚                                             â”‚
â”‚   â€¢ unique_peers           â”‚                                             â”‚
â”‚   â€¢ message_rate           â”‚                                             â”‚
â”‚   â€¢ session_resets         â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ Raw BGP messages
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA INGESTION LAYER                                â”‚
â”‚                                                                           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚   RIS Live      â”‚ â† WebSocket connection            â”‚
â”‚                   â”‚   Collector     â”‚   (buffer: 50 messages)           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘
                                      â”‚ Real-time BGP feed
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NETWORK LAYER                                   â”‚
â”‚                                                                           â”‚
â”‚              RIS Live (RIPE NCC Real-Time BGP Feeds)                     â”‚
â”‚              Multiple collectors worldwide                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Model Drift Detection System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL DRIFT MONITORING                                â”‚
â”‚                                                                           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚  Drift Monitor  â”‚ â† Checks every hour               â”‚
â”‚                   â”‚    Service      â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â”‚                                             â”‚
â”‚                            â”‚ Monitors 3 models:                          â”‚
â”‚                            â”‚ â€¢ LSTM                                      â”‚
â”‚                            â”‚ â€¢ Isolation Forest                          â”‚
â”‚                            â”‚ â€¢ Heuristic                                 â”‚
â”‚                            â”‚                                             â”‚
â”‚                            â†“                                             â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚ Detect Drift?   â”‚                                    â”‚
â”‚                   â”‚                 â”‚                                    â”‚
â”‚                   â”‚ â€¢ Score shift   â”‚                                    â”‚
â”‚                   â”‚ â€¢ Anomaly rate  â”‚                                    â”‚
â”‚                   â”‚ â€¢ Confidence    â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â”‚                                             â”‚
â”‚                    YES â†â”€â”€â”€â”´â”€â”€â”€â†’ NO                                      â”‚
â”‚                     â”‚              â”‚                                     â”‚
â”‚                     â†“              â†“                                     â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚          â”‚   Trigger    â”‚    â”‚Continue â”‚                                â”‚
â”‚          â”‚  Retraining  â”‚    â”‚Monitoringâ”‚                               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RETRAINING SYSTEM                                   â”‚
â”‚                                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚    Retrain      â”‚   â”‚    Retrain      â”‚   â”‚    Retrain      â”‚     â”‚
â”‚   â”‚     LSTM        â”‚   â”‚   Isolation     â”‚   â”‚   Heuristic     â”‚     â”‚
â”‚   â”‚                 â”‚   â”‚     Forest      â”‚   â”‚                 â”‚     â”‚
â”‚   â”‚  ~5-10 min      â”‚   â”‚   ~30 sec       â”‚   â”‚   ~10 sec       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚            â”‚                     â”‚                     â”‚               â”‚
â”‚            â†“                     â†“                     â†“               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Hot-Swap LSTM   â”‚   â”‚  Hot-Swap IF    â”‚   â”‚ Hot-Swap Rules  â”‚     â”‚
â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚     â”‚
â”‚   â”‚ 1. Backup old   â”‚   â”‚ 1. Backup old   â”‚   â”‚ 1. Backup old   â”‚     â”‚
â”‚   â”‚ 2. Save new     â”‚   â”‚ 2. Save new     â”‚   â”‚ 2. Save new     â”‚     â”‚
â”‚   â”‚ 3. Replace      â”‚   â”‚ 3. Replace      â”‚   â”‚ 3. Replace      â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚            â”‚                     â”‚                     â”‚               â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                  â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DETECTOR AUTO-RELOAD                                  â”‚
â”‚                                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  LSTM Detector  â”‚   â”‚   IF Detector   â”‚   â”‚  Heur Detector  â”‚     â”‚
â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚     â”‚
â”‚   â”‚ Checks file     â”‚   â”‚ Checks file     â”‚   â”‚ Checks file     â”‚     â”‚
â”‚   â”‚ modification    â”‚   â”‚ modification    â”‚   â”‚ modification    â”‚     â”‚
â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚     â”‚
â”‚   â”‚ If changed:     â”‚   â”‚ If changed:     â”‚   â”‚ If changed:     â”‚     â”‚
â”‚   â”‚  â†’ Reload model â”‚   â”‚  â†’ Reload model â”‚   â”‚  â†’ Reload rules â”‚     â”‚
â”‚   â”‚  â†’ Continue     â”‚   â”‚  â†’ Continue     â”‚   â”‚  â†’ Continue     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                           â”‚
â”‚   â±ï¸ Reload happens on next detection cycle (~10 seconds)                â”‚
â”‚   âœ… No system downtime                                                   â”‚
â”‚   âœ… No alerts lost                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Data Flow (with Drift Detection)

```
Step 1: BGP Data Collection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    RIS Live (Real-time BGP)
            â†“
    WebSocket connection
            â†“
    RIS Live Collector (buffer: 50 msgs)
            â†“
    PostgreSQL (raw_bgp_data)

Step 2: Feature Extraction
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Feature Aggregator (every 30s)
            â†“
    9 features calculated
            â†“
    PostgreSQL (features table)

Step 3: ML Detection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Heuristic â”€â”€â”
    LSTM       â”€â”¼â”€â”€â†’ Ensemble â”€â”€â†’ Correlation
    Iso Forest â”€â”˜                      â†“
                              PostgreSQL (ml_results)

Step 4: Presentation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FastAPI (REST endpoints)
            â†“
    Dashboard (real-time updates)

Step 5: Drift Monitoring (Background)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Drift Monitor (every hour)
            â†“
    Check model performance
            â†“
    Compare to baseline (7 days)
            â†“
    Drift detected? â”€â”€NOâ”€â”€â†’ Continue monitoring
            â”‚
           YES
            â†“
    Trigger retraining (automatic)
            â†“
    Retrain specific model
            â†“
    Hot-swap new model
            â†“
    Detector auto-reloads (~10s)
            â†“
    Detection continues (no downtime)
```

---

## Service Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Service Startup Order                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. PostgreSQL Database
   â†“
2. RIS Live Collector (data source)
   â†“ (wait 5s)
3. Feature Aggregator (needs raw data)
   â†“ (wait 3s)
4. Detectors (need features)
   â”œâ”€â†’ Heuristic Detector
   â”œâ”€â†’ LSTM Detector
   â””â”€â†’ Isolation Forest Detector
   â†“ (wait 2s)
5. Ensemble Coordinator (needs detector results)
   â†“ (wait 2s)
6. Correlation Engine (needs ensemble results)
   â†“ (wait 2s)
7. FastAPI Server (needs all data)
   â†“
8. Drift Monitor (independent, runs in parallel)
```

---

## Model Independence During Retraining

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Independent Model Retraining                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario: LSTM retraining triggered

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Heuristic  â”‚   â”‚     LSTM     â”‚   â”‚  Isolation   â”‚
â”‚   Detector   â”‚   â”‚   Detector   â”‚   â”‚    Forest    â”‚
â”‚              â”‚   â”‚              â”‚   â”‚   Detector   â”‚
â”‚   âœ… ACTIVE  â”‚   â”‚   âœ… ACTIVE  â”‚   â”‚   âœ… ACTIVE  â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚   Detecting  â”‚   â”‚   Detecting  â”‚   â”‚   Detecting  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ LSTM retraining starts
                           â”‚ (in background, 5-10 min)
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Heuristic  â”‚   â”‚     LSTM     â”‚   â”‚  Isolation   â”‚
â”‚   Detector   â”‚   â”‚   Detector   â”‚   â”‚    Forest    â”‚
â”‚              â”‚   â”‚              â”‚   â”‚   Detector   â”‚
â”‚   âœ… ACTIVE  â”‚   â”‚   âœ… ACTIVE  â”‚   â”‚   âœ… ACTIVE  â”‚
â”‚              â”‚   â”‚   (old model)â”‚   â”‚              â”‚
â”‚   Detecting  â”‚   â”‚   Detecting  â”‚   â”‚   Detecting  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    Ensemble Voting
                    (all 3 models)
                           â”‚
                           â†“
                   Results continue
                   (no interruption)

                   LSTM retraining completes
                           â”‚
                           â†“ Hot-swap
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Heuristic  â”‚   â”‚     LSTM     â”‚   â”‚  Isolation   â”‚
â”‚   Detector   â”‚   â”‚   Detector   â”‚   â”‚    Forest    â”‚
â”‚              â”‚   â”‚              â”‚   â”‚   Detector   â”‚
â”‚   âœ… ACTIVE  â”‚   â”‚   âœ… RELOADEDâ”‚   â”‚   âœ… ACTIVE  â”‚
â”‚              â”‚   â”‚   (new model)â”‚   â”‚              â”‚
â”‚   Detecting  â”‚   â”‚   Detecting  â”‚   â”‚   Detecting  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    Ensemble Voting
                    (improved LSTM)
```

**Key Benefits:**
- âœ… No system downtime
- âœ… Other models compensate during retraining
- âœ… Ensemble continues voting with available models
- âœ… Seamless transition to new model

---

## File Structure

```
E:\Advantal_models\lstm_model\
â”‚
â”œâ”€â”€ services/                         # All microservices
â”‚   â”œâ”€â”€ ris_live_collector.py        # Data collection
â”‚   â”œâ”€â”€ feature_aggregator.py        # Feature extraction
â”‚   â”œâ”€â”€ heuristic_detector.py        # Rule-based detection
â”‚   â”œâ”€â”€ lstm_detector.py             # Temporal detection
â”‚   â”œâ”€â”€ isolation_forest_detector.py # Statistical detection
â”‚   â”œâ”€â”€ ensemble_coordinator.py      # Combine scores
â”‚   â”œâ”€â”€ correlation_engine.py        # Alert correlation
â”‚   â””â”€â”€ drift_monitor.py             # ğŸ†• Model monitoring
â”‚
â”œâ”€â”€ model_artifacts/                  # Model files
â”‚   â”œâ”€â”€ iso_forest_bgp_production.pkl           # IF model
â”‚   â”œâ”€â”€ iso_forest_bgp_production_backup_*.pkl  # IF backups
â”‚   â”œâ”€â”€ heuristic_rules.json                    # Rules
â”‚   â”œâ”€â”€ heuristic_rules_backup_*.json           # Rule backups
â”‚   â”œâ”€â”€ drift_report_*.json                     # Drift reports
â”‚   â””â”€â”€ retrain_*.flag                          # Retraining flags
â”‚
â”œâ”€â”€ model_output/                     # LSTM model
â”‚   â”œâ”€â”€ lstm_model_for_pkl.weights.h5           # LSTM weights
â”‚   â”œâ”€â”€ lstm_model_for_pkl_backup_*.weights.h5  # LSTM backups
â”‚   â”œâ”€â”€ scaler.pkl                              # Feature scaler
â”‚   â””â”€â”€ lstm_metadata_new.json                  # Training metadata
â”‚
â”œâ”€â”€ retrain_isolation_forest.py       # ğŸ†• IF retraining
â”œâ”€â”€ retrain_lstm.py                   # ğŸ†• LSTM retraining
â”œâ”€â”€ retrain_heuristic.py              # ğŸ†• Heuristic retraining
â”‚
â”œâ”€â”€ test_retraining.py                # ğŸ†• Test all retraining
â”œâ”€â”€ check_drift_status.py             # ğŸ†• Monitor drift status
â”‚
â”œâ”€â”€ api.py                            # FastAPI backend
â”œâ”€â”€ dashboard_clean.html              # Real-time dashboard
â”œâ”€â”€ run_all_services.py               # Service manager (updated)
â”œâ”€â”€ check_realtime.py                 # Check data freshness
â”œâ”€â”€ check_database.py                 # Database diagnostics
â”‚
â”œâ”€â”€ DRIFT_DETECTION_README.md         # ğŸ†• Full documentation
â””â”€â”€ DRIFT_QUICK_START.md              # ğŸ†• Quick start guide
```

---

## Performance Metrics

| Component | Processing Time | Data Freshness | Update Frequency |
|-----------|----------------|----------------|------------------|
| RIS Collector | Real-time | 5-15 min | Continuous |
| Feature Aggregator | < 1 second | 5-15 min | Every 30 seconds |
| Detectors | < 100 ms | 5-15 min | Every 10 seconds |
| Ensemble | < 50 ms | 5-15 min | Every 10 seconds |
| API | < 1 second | Real-time | On request |
| Dashboard | < 1 second | Real-time | Every 10 seconds |
| Drift Monitor | < 5 seconds | Historical | Every 1 hour |
| IF Retraining | ~30 seconds | - | On drift |
| LSTM Retraining | ~5-10 min | - | On drift |
| Heuristic Update | ~10 seconds | - | On drift |

---

## System Capacity

| Resource | Limit | Auto-Cleanup |
|----------|-------|-------------|
| raw_bgp_data | 50,000 records | âœ… Yes (30 days) |
| features | 50,000 records | âœ… Yes (30 days) |
| ml_results | 50,000 records | âœ… Yes (30 days) |
| correlations | 50,000 records | âœ… Yes (30 days) |
| Model backups | Unlimited | âŒ Manual cleanup |
| Drift reports | Unlimited | âŒ Manual cleanup |

---

**System Architecture Complete!**

For detailed documentation:
- Drift Detection: [DRIFT_DETECTION_README.md](DRIFT_DETECTION_README.md)
- Quick Start: [DRIFT_QUICK_START.md](DRIFT_QUICK_START.md)
