<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGP Anomaly Detection Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            font-size: 24px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            color: #333;
            font-size: 32px;
            font-weight: bold;
        }

        .severity-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .severity-item {
            text-align: center;
            padding: 10px;
            border-radius: 4px;
        }

        .severity-critical { background: #fee; color: #c00; }
        .severity-high { background: #ffe; color: #c60; }
        .severity-medium { background: #fef; color: #06c; }
        .severity-low { background: #efe; color: #060; }

        .severity-count {
            font-size: 24px;
            font-weight: bold;
        }

        .severity-label {
            font-size: 12px;
            text-transform: uppercase;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .alert-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 4px solid #ccc;
        }

        .alert-critical { border-left-color: #c00; background: #fee; }
        .alert-high { border-left-color: #c60; background: #ffe; }
        .alert-medium { border-left-color: #06c; background: #fef; }
        .alert-low { border-left-color: #060; background: #efe; }

        .alert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .alert-type {
            font-weight: bold;
            font-size: 14px;
        }

        .alert-severity {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 3px;
            text-transform: uppercase;
        }

        .alert-peer {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .alert-desc {
            font-size: 13px;
            color: #444;
        }

        .peer-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 13px;
        }

        .peer-addr {
            font-weight: bold;
            color: #333;
        }

        .peer-stats {
            color: #666;
            margin-top: 5px;
        }

        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .refresh-btn:hover {
            background: #0056b3;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .last-updated {
            color: #999;
            font-size: 12px;
            text-align: right;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            .severity-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>BGP Anomaly Detection Dashboard</h1>
            <div class="subtitle">Real-time monitoring of BGP route anomalies and security threats</div>
        </header>

        <div id="error-container"></div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Alerts</div>
                <div class="stat-value" id="total-alerts">--</div>
                <div class="severity-grid" id="severity-breakdown">
                    <div class="severity-item severity-critical">
                        <div class="severity-count" id="critical-count">0</div>
                        <div class="severity-label">Critical</div>
                    </div>
                    <div class="severity-item severity-high">
                        <div class="severity-count" id="high-count">0</div>
                        <div class="severity-label">High</div>
                    </div>
                    <div class="severity-item severity-medium">
                        <div class="severity-count" id="medium-count">0</div>
                        <div class="severity-label">Medium</div>
                    </div>
                    <div class="severity-item severity-low">
                        <div class="severity-count" id="low-count">0</div>
                        <div class="severity-label">Low</div>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Total Detections</div>
                <div class="stat-value" id="total-detections">--</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Anomaly Rate</div>
                <div class="stat-value" id="anomaly-rate">--%</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Active Peers</div>
                <div class="stat-value" id="active-peers">--</div>
            </div>
        </div>

        <div class="content-grid">
            <div class="panel">
                <div class="panel-title">Recent Alerts</div>
                <div id="alerts-container" class="loading">Loading alerts...</div>
                <button class="refresh-btn" onclick="loadAlerts()">Refresh Alerts</button>
                <div class="last-updated" id="alerts-updated"></div>
            </div>

            <div class="panel">
                <div class="panel-title">Monitored Peers</div>
                <div id="peers-container" class="loading">Loading peers...</div>
                <button class="refresh-btn" onclick="loadPeers()">Refresh Peers</button>
                <div class="last-updated" id="peers-updated"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';

        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const data = await response.json();

                document.getElementById('total-alerts').textContent = data.total_alerts;
                document.getElementById('total-detections').textContent = data.total_detections;
                document.getElementById('anomaly-rate').textContent = data.anomaly_rate + '%';
                document.getElementById('active-peers').textContent = data.active_peers;

                // Update severity breakdown
                document.getElementById('critical-count').textContent = data.alerts_by_severity.critical || 0;
                document.getElementById('high-count').textContent = data.alerts_by_severity.high || 0;
                document.getElementById('medium-count').textContent = data.alerts_by_severity.medium || 0;
                document.getElementById('low-count').textContent = data.alerts_by_severity.low || 0;

            } catch (error) {
                showError('Failed to load statistics: ' + error.message);
            }
        }

        // Load alerts
        async function loadAlerts() {
            const container = document.getElementById('alerts-container');
            container.innerHTML = '<div class="loading">Loading alerts...</div>';

            try {
                const response = await fetch(`${API_BASE}/alerts?limit=10`);
                const alerts = await response.json();

                if (alerts.length === 0) {
                    container.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">No alerts found</div>';
                    return;
                }

                container.innerHTML = alerts.map(alert => `
                    <div class="alert-item alert-${alert.severity}">
                        <div class="alert-header">
                            <span class="alert-type">${alert.alert_type}</span>
                            <span class="alert-severity">${alert.severity}</span>
                        </div>
                        <div class="alert-peer">Peer: ${alert.peer_addr}</div>
                        <div class="alert-desc">${alert.description}</div>
                    </div>
                `).join('');

                document.getElementById('alerts-updated').textContent = 
                    'Last updated: ' + new Date().toLocaleTimeString();

            } catch (error) {
                container.innerHTML = '<div class="error">Failed to load alerts: ' + error.message + '</div>';
            }
        }

        // Load peers
        async function loadPeers() {
            const container = document.getElementById('peers-container');
            container.innerHTML = '<div class="loading">Loading peers...</div>';

            try {
                const response = await fetch(`${API_BASE}/peers?limit=15`);
                const peers = await response.json();

                if (peers.length === 0) {
                    container.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">No peers found</div>';
                    return;
                }

                container.innerHTML = peers.map(peer => `
                    <div class="peer-item">
                        <div class="peer-addr">${peer.peer_addr}</div>
                        <div class="peer-stats">
                            Detections: ${peer.total_detections} | 
                            Anomalies: ${peer.anomaly_count} | 
                            Rate: ${peer.anomaly_rate}%
                        </div>
                    </div>
                `).join('');

                document.getElementById('peers-updated').textContent = 
                    'Last updated: ' + new Date().toLocaleTimeString();

            } catch (error) {
                container.innerHTML = '<div class="error">Failed to load peers: ' + error.message + '</div>';
            }
        }

        // Show error message
        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        // Load all data
        function loadAll() {
            loadStatistics();
            loadAlerts();
            loadPeers();
        }

        // Initial load
        loadAll();

        // Auto-refresh every 30 seconds
        setInterval(loadAll, 30000);
    </script>
</body>
</html>
